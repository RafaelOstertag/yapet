<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE refentry PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
	  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd"
[
<!ENTITY cpr SYSTEM "@srcdir@/copyright.sgml">
<!ENTITY supplatforms SYSTEM "@srcdir@/supportedplatforms.sgml">
<!ENTITY pwrecord SYSTEM "@srcdir@/pwrecord.sgml">
<!ENTITY caution SYSTEM "@srcdir@/caution.sgml">
<!ENTITY license SYSTEM "@srcdir@/license.sgml">
<!ENTITY bugreport SYSTEM "@srcdir@/bugreport.sgml">
<!ENTITY OPENSSL "<citerefentry><refentrytitle>ssl</refentrytitle>
<manvolnum>3</manvolnum></citerefentry>">
<!ENTITY CRYPTO "<citerefentry><refentrytitle>crypto</refentrytitle>
<manvolnum>3</manvolnum></citerefentry>">
<!ENTITY CURSES "<citerefentry><refentrytitle>curses</refentrytitle>
<manvolnum>3X</manvolnum></citerefentry>">
<!ENTITY YP "@PACKAGE_NAME@">
<!ENTITY yp "<command>@PACKAGE@</command>">
<!ENTITY ypman "<citerefentry><refentrytitle>yapet</refentrytitle>
<manvolnum>1</manvolnum></citerefentry>">
<!ENTITY CSV2YAPET "csv2yapet">
<!ENTITY csv2yapet "<command>csv2yapet</command>">
<!ENTITY csv2yapetman "<citerefentry><refentrytitle>csv2yapet</refentrytitle>
<manvolnum>1</manvolnum></citerefentry>">
<!ENTITY FREEBSD "<trademark class='registered'>FreeBSD</trademark>">
<!ENTITY SOLARIS "<trademark class='trademark'>Sun</trademark>
<trademark class='trademark'>Solaris</trademark>">
<!ENTITY YPPKG "@PACKAGE_TARNAME@-@PACKAGE_VERSION@.tar.gz">
<!ENTITY YPVER "@PACKAGE_VERSION@">
]>
<refentry id="yapet">
  <!-- $Id$ -->

  <refentryinfo>
     <productname>yapet</productname>
     &cpr;
  </refentryinfo>

  <refmeta>
    <refentrytitle>yapet</refentrytitle>
    <manvolnum>1</manvolnum>
    <refmiscinfo class="version">@PACKAGE_VERSION@</refmiscinfo>
    <refmiscinfo class="manual">User Commands</refmiscinfo>
  </refmeta>

  <refnamediv>
    <refname>yapet</refname>
    <refpurpose>store passwords encrypted on disk</refpurpose>
  </refnamediv>

  <refsynopsisdiv>
    <cmdsynopsis cmdlength="5">
      &yp;
      <group>
	<arg choice="opt" rep="norepeat"><option>-c</option></arg>
	<arg choice="opt" rep="norepeat"><option>-h</option></arg>
	<arg choice="opt" rep="norepeat"><option>-V</option></arg>
      </group>
      <group>
	<arg choice="opt" rep="norepeat"><option>-s</option></arg>
	<arg choice="opt" rep="norepeat"><option>-S</option></arg>
      </group>
      <arg choice="opt" rep="norepeat"><option>-t</option> <arg choice="req"
      rep="norepeat"><replaceable>sec</replaceable></arg></arg>

      <arg><replaceable>filename</replaceable></arg>
    </cmdsynopsis>
  </refsynopsisdiv>

  <!--
  -
  -  DESCRIPTION
  -
  -->
  <refsect1 id="description">
    <title>DESCRIPTION</title>

    <para>&yp; stands for "Yet Another Password Encryption Tool" and
    is a &CURSES; based program for storing passwords encrypted on
    disk. It relies on the &CRYPTO; library provided by OpenSSL for
    encrypting and decrypting the passwords. The cipher for encryption
    and decryption is Blowfish with a 448 bits key.
    </para>

    <para>Invoking &yp; without any command line arguments given, a screen as
    shown in "<xref linkend="fig.mainscreen" />" will be displayed.</para>

<figure id="fig.mainscreen">
  <title>Main screen</title>
  <mediaobject>
    <textobject>
<screen format="linespecific">
		  ..::|| YAPET @PACKAGE_VERSION@ ||::..
+---------------------------++---------------------------+
|                           ||          K E Y S          |
|                           ||---------------------------|
|                           ||   S     Save File         |
|                           ||   R     Load File         |
|                           ||   L     Lock Screen       |
|                           ||   A     Add Entry         |
|                           ||   D     Delete Entry      |
|                           ||   O     Sort Order        |
|                           ||   /     Search            |
|                           ||   N     Search Next       |
|                           ||   C     Change Password   |
|                           ||   ^L    Redraw Screen     |
|                           ||   Q     Quit              |
|                           ||                           |
|                           |+---------------------------+
|                           |+---------------------------+
|                           ||                           |
|                           ||                           |
|                           ||                           |
|                           ||                           |
+---------------------------++---------------------------+
No file loaded
</screen>
    </textobject>
  </mediaobject>
</figure>

    <para>The upper right frame in "<xref linkend="fig.mainscreen" />" shows the
    keys recognized by &yp;. The keys are not case-sensitive. Following a short
    explanation of the keys:
    </para>

    <variablelist>

      <varlistentry>
	<term><keycap>S</keycap></term>

	<listitem>
	  <simpara>Saves the password records to the file.</simpara>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><keycap>R</keycap></term>

	<listitem>
	  <para>Load (read) a file from disk. This command is also used to
	  create a new file. When creating a new file, enter the file name into
	  the entry field. &yp; will ask whether it should create the file if
	  it does not exist.
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><keycap>L</keycap></term>

	<listitem>
	  <para>Lock and blank the screen. Has only effect if a file is
	  loaded. In order to unlock the screen, the password of the currently
	  loaded file has to be entered.
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><keycap>A</keycap></term>

	<listitem>
	  <para>Add a new password entry to the currently loaded file. The
	  entry will be permanently added to the file when the file is saved by
	  pressing <keycap>S</keycap>.
	  </para>

	  <para>Before this function can be used an existing file has to be
	  loaded, or a new file has to be created by pressing
	  <keycap>R</keycap>.
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><keycap>D</keycap></term>

	<listitem>
	  <para>Delete a password entry from the currently loaded file. The
	  entry will be permanently deleted if the file is saved by pressing
	  <keycap>S</keycap>.
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><keycap>O</keycap></term>

	<listitem>
	  <para>Change the sort order to either ascending or descending. This
	  setting is not kept permanently and is lost upon restart of
	  &yp;.</para>

	  <para>The default sort order is ascending.
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><keycap>/</keycap></term>

	<listitem>
	  <para>Start a new search. &yp; can search the name of the entries for
	  a particular term. If the term is found, the item is highlighted. The
	  search can be repeated by pressing <keycap>N</keycap>.
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><keycap>N</keycap></term>

	<listitem>
	  <para>Repeat the search using the search term specified by invoking the
	  search functionality by pressing <keycap>/</keycap>.
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><keycap>C</keycap></term>

	<listitem>
	  <para>Change the master password of the currently loaded file. This
	  action requires to save all changes first. The file with the old
	  master password will be saved as
	  <filename><replaceable>filename</replaceable>.pet.bak</filename> where
	  <replaceable>filename</replaceable> is the name of the currently
	  loaded file.
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><keycombo action="simul"><keycap>CTRL</keycap>
	<keycap>L</keycap></keycombo> (<keycap>^L</keycap>)</term>

	<listitem>
	  <para>Redraws the screen.
	  </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><keycap>Q</keycap></term>

	<listitem>
	  <para>Quit &yp;. If changes were not saved &yp; will ask
	  whether they should be saved or not. Regardless of the answer, &yp;
	  quits, either saving the changes or discarding them.
	  </para>
	</listitem>
      </varlistentry>

    </variablelist>

    <para>The empty frame on the left side of the main screen will display the
    password entries' <guilabel>Name</guilabel>. The selection can be moved by
    using <keycap>Up</keycap>, <keycap>Down</keycap>, <keycap>Page Up</keycap>,
    <keycap>Page Down</keycap>, <keycap>Home</keycap>, and <keycap>End</keycap>
    keys. An entry can be opened for viewing and editing by pressing
    <keycap>Enter</keycap>.</para>

    <para>Passwords are stored as records (also referred to as entries)
    having the fields as shown in "<xref linkend="fig.pwrecord" />" below.</para>

<figure id="fig.pwrecord">
  <title>Password record dialog</title>
  <mediaobject>
    <textobject>
<screen format="linespecific">
+-P A S S W O R D  R E C O R D--------------------+
|Name                                             |
|_________________________________________________|
|Host                                             |
|_________________________________________________|
|Username                                         |
|_________________________________________________|
|Password                                         |
|_________________________________________________|
|Comment                                          |
|_________________________________________________|
|                                                 |
|[ OK ] [ Cancel ]                                |
+-------------------------------------------------+
</screen>
    </textobject>
  </mediaobject>
</figure>

    <para>The fields have the following meaning:</para>

    &pwrecord;

    <para>Files created by &yp; always have the suffix
    <filename>.pet</filename>. This cannot be changed by the user. Also, if a
    file is loaded using the command line the suffix <filename>.pet</filename>
    is appended to the file name given that it was not specified by the
    user.</para>

    <para>The password entries are protected by a master password. The master
    password is used to encrypt and decrypt the records. If the master password
    is lost, so are the records.</para>

    <para>The <keycap>Tab</keycap> key will switch the focus to the next
    widget. Be aware
    that <keycombo action="simul"><keycap>Shift</keycap><keycap>Tab</keycap></keycombo>
    does not work for focusing the previous widget.</para>

    <para>By pressing the <keycap>Esc</keycap> key dialogs will be canceled and
    closed.</para>

    <para>If there is no key pressed for more than ten minutes (by default) or
    the amount of time specified using the <option>-t</option> option, &yp;
    will blank and lock the screen. It will prompt for the password of the
    currently load file when a key is pressed. This is the same behavior as
    seen by pressing the key <keycap>L</keycap>.</para>

  </refsect1>

  <!--
  -
  -  OPTIONS
  -
  -->
  <refsect1 id="options">
    <title>OPTIONS</title>

    <para>The following options are supported:</para>

    <variablelist>
      <varlistentry>
	<term><option>-c</option>, <option>--copyright</option></term>
	<listitem>
	  <para>Show the copyright information.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><option>-h</option>, <option>--help</option></term>
	<listitem>

	  <para>Print a help text.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><option>-s</option>, <option>--no-file-security</option></term>

	<listitem>
	  <para>Disable the check for the owner and file mode when loading
	  files. Without this option, &yp; checks password files for having the
	  same owner as the user running &yp; and verifies that the file mode
	  is strictly 0600. If one of these conditions are not met, &yp; refuses
	  to load the file. Providing this options disables those checks and
	  &yp; will load files with owners other than the process owner of
	  &yp; and file modes different from 0600.</para>

	  <para>New files saved while this option is active will have the file
	  mode set to 0644.</para>

	</listitem>
      </varlistentry>

      <varlistentry>
	<term><option>-S</option>, <option>--file-security</option></term>

	<listitem>
	  <para>Enable the check for the owner and file mode when loading
	  files. This option makes &yp; to load password files having the
	  owner set to the process owner of &yp; and the file mode strictly set
	  to 0600 only. If one of these conditions are not met, &yp; refuses to
	  load the file.</para>

	  <para>New files saved while this option is active will have the file
	  mode set to 0600.</para>

	  <para>This is the default mode.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><option>-t</option> <replaceable>sec</replaceable>,
	<option>--timeout</option> <replaceable>sec</replaceable></term>

	<listitem>

	  <para>Set the timeout until the screen is locked to
	  <replaceable>sec</replaceable> seconds. The minimum time allowed is
	  10 seconds. If a lower value is provided, the timeout will be set to
	  10 seconds.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><option>-V</option>, <option>--version</option></term>
	<listitem>

	  <para>Show the version of &yp;.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><option><replaceable>filename</replaceable></option></term>

	<listitem>
	  <para>The file to open upon invocation of &yp;. If the file does not
	  exist, &yp; asks whether it should be created.
	  </para>

	  <para>Files created by &yp; always have the suffix <filename
	  moreinfo="none">.pet</filename>.
	  </para>
	</listitem>
      </varlistentry>

    </variablelist>
  </refsect1>

  <refsect1 id="configurationfile">
    <title>CONFIGURATION FILE</title>

    <para>If the file <filename>~/.yapet</filename> exists, &yp; reads the
    options provided in this file. Options given on the command line have
    precedence over options given in the configuration file.
    </para>

    <para>The configuration file has the following syntax:</para>

    <informalexample>
      <para><replaceable>option</replaceable>=<replaceable>value</replaceable></para>
    </informalexample>

    <para>where <replaceable>option</replaceable> can be any of the following:</para>

    <variablelist>
      <varlistentry>
	<term><option>load</option></term>

	<listitem>
	  <para>The file to load upon start of &yp;.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><option>locktimeout</option></term>

	<listitem>
	  <para>A positive integer specifying the time of inactivity in seconds until
	  the screen is locked.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><option>checkfsecurity</option></term>

	<listitem>
	  <para>A value of 1 (one) or 0 (zero). A value of 1 enables the
	  verification of the file owner and permissions when loading a file. A
	  value of 0 disables the verification of the file owner and
	  permissions when loading a file.</para>
	</listitem>
      </varlistentry>
    </variablelist>

    <para>See <xref linkend="examples" /> for examples of configuration
    files.</para>

    <para>Options are case-sensitive. Spaces are not allowed before or after
    the equal sign. Syntax errors and unrecognized options are ignored
    silently.</para>
  </refsect1>

  <!--
  -
  -  CAUTION
  -
  -->
  <refsect1 id="caution">
    <title>CAUTION</title>
    &caution;
  </refsect1>

  <!--
      -
      - FILES
      -
  -->
  <refsect1 id="files">
    <title>FILES</title>

    <variablelist>
      <varlistentry>
	<term><envar>$HOME</envar><filename>/.yapet</filename></term>

	<listitem>
	  <para>The per-user configuration file. If existing, options are read
	  from this file but can be overridden by the command line
	  options.</para>
	</listitem>
      </varlistentry>
    </variablelist>
  </refsect1>

  <!--
  -
  - EXAMPLES
  -
  -->

  <refsect1 id="examples">
    <title>EXAMPLES</title>

    <example id="ex.cfgfile1">
      <title>Example of an &yp; configuration file.</title>

      <literallayout>load=/home/joe/passwords
locktimeout=300
checkfsecurity=0</literallayout>

      <para>In this example, the file <filename>/home/joe/passwords</filename>
      will be loaded upon invocation of &yp;. The timeout until the screen is
      locked set to 300 seconds. File permissions will not be verified.</para>
    </example>

    <example id="ex.cfgfile2">
      <title>Example of an &yp; configuration file.</title>

      <literallayout>locktimeout=150
checkfsecurity=1</literallayout>

      <para>In this example, no file will be automatically loaded upon
      invocation of &yp;. The timeout until the screen is locked set to 150
      seconds. File permissions and owner will be verified.</para>
    </example>

  </refsect1>

  <!--
  -
  -  BUGS
  -
  -->
  <refsect1 id="bugs">
    <title>BUGS</title>

    <itemizedlist>
      <listitem>
	<para>The user interface is clumsy and not really user friendly. It may
	flicker while running &yp; in a secure shell session.</para>
      </listitem>

      <listitem>
	<para>Clearing the memory when it is no longer used seems buggy since
	the master password is written to a core file sometimes.</para>
      </listitem>

    </itemizedlist>

    &bugreport;
  </refsect1>

  <!--
  -
  - AVAILABILITY
  -
  -->
  <refsect1 id="availability">
    <title>AVAILABILITY</title>

    <para>The latest version of &yp; can be found under <ulink
    url="http://www.guengel.ch/myapps/yapet/">http://www.guengel.ch/myapps/yapet/</ulink>.</para>
  </refsect1>
  <!--
  -
  -  AUTHOR
  -
  -->
  <refsect1 id="author">
    <title>AUTHOR</title>
    <simpara>Rafael Ostertag <email>rafi@guengel.ch</email></simpara>
  </refsect1>

  <!--
  -
  -  SEE ALSO
  -
  -->
  <refsect1 id="seealso">
    <title>SEE ALSO</title>

    <simpara>&csv2yapetman;, &CURSES;, &OPENSSL;, &CRYPTO;</simpara>
  </refsect1>

  <!--
      -
      - LICENSE
      -
  -->
  <refsect1 id="license">
    <title>LICENSE</title>

    &license;
  </refsect1>

</refentry>
